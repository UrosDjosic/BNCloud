<div class="song-container" *ngIf="song">
  <mat-card class="song-card mat-elevation-z4">

    <!-- Song Header -->
    <div class="song-header">
      <img *ngIf="song.image" [src]="song.image" alt="{{ song.name }}" class="song-image" />
      <div class="song-title-meta">
        <h2 class="title">{{ song.name }}</h2>
        <p class="file-name">{{ song.fileName }}</p>
        <p class="genres" *ngIf="song.genres?.length">
          <strong>Genres:</strong>
          <span *ngFor="let g of song.genres; let last = last">
    {{ g.name }}<span *ngIf="!last">, </span>
  </span>
        </p>
      </div>
    </div>

    <!-- Audio Player -->
    <div class="audio-player" *ngIf="song.audio">
      <audio [src]="song.audio" controls></audio>
    </div>

    <!-- Metadata -->
    <div class="metadata mat-subheading-1">
      <p><strong>Created At:</strong> {{ song.creationTime | date:'medium' }}</p>
      <p><strong>Last Modified:</strong> {{ song.modificationTime | date:'medium' }}</p>
      <p><strong>Artists:</strong>
        <span *ngFor="let artistId of song.artists; let last = last">
  <a [routerLink]="['/author', artistId]">
    {{ artistNames[artistId] || 'Loading...' }}
  </a>{{ last ? '' : ', ' }}
</span>
      </p>
      <p><strong>Ratings:</strong>
        <span *ngIf="song.ratings?.length; else noRatings">
          {{ song.ratings.join(', ') }}
        </span>
        <ng-template #noRatings>Not rated yet</ng-template>
      </p>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button mat-stroked-button color="primary" (click)="subscribeSong()">
        Subscribe
      </button>
      <button mat-stroked-button color="accent" (click)="addToUserList()">
        Add to My List
      </button>
      <button mat-stroked-button color="warn" (click)="downloadSong()">
        Download
      </button>
      <span class="rating-buttons">
        <button mat-stroked-button *ngFor="let s of [1,2,3,4,5]" (click)="rateSong(s)">
          {{ s }} Star{{ s > 1 ? 's' : '' }}
        </button>
      </span>
      <button mat-stroked-button color="primary" (click)="editSong()">
        Edit
      </button>
      <button mat-stroked-button color="warn" (click)="deleteSong()">
        Delete
      </button>
    </div>

  </mat-card>
</div>
