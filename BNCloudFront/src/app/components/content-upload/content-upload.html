<div class="upload-container">
  <mat-card class="upload-card">
    <h2 class="title">Upload Songs</h2>

    <div *ngFor="let song of uploads; let i = index" class="song-upload">
      <h3>Song {{ i + 1 }}</h3>

      <!-- Audio File Upload (no mat-form-field) -->
      <div class="file-input">
        <label>Audio File:</label>
        <input type="file" (change)="onFileSelected($event, i)" accept="audio/*" />
      </div>

      <div *ngIf="song.fileName" class="file-info">
        <p><strong>File Name:</strong> {{ song.fileName }}</p>
        <p><strong>Type:</strong> {{ song.fileType }}</p>
        <p><strong>Size:</strong> {{ (song.fileSize || 0) / 1000 | number:'1.0-0' }} KB</p>
        <p><strong>Modified:</strong> {{ song.modificationTime | date:'short' }}</p>
      </div>

      <br>

      <!-- Song Name -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Song Title</mat-label>
        <input matInput [(ngModel)]="song.name" placeholder="e.g. Lost in Sound" />
      </mat-form-field>

      <p style="font-size: 1rem; font-style: oblique;font-weight: bold"  >Genres</p>
      <div class="genre-container">
        <div class="genre-buttons">
          <button
            type="button"
            *ngFor="let genre of availableGenres"
            mat-raised-button
            [ngClass]="{'selected-genre': isGenreSelected(song, genre)}"
            (click)="toggleGenre(song, genre)">
            {{ genre.name }}
          </button>

        </div>
      </div>

      <!-- New Genres -->
      <mat-form-field class="full-width" appearance="outline" style="margin-bottom:1rem; ">
        <mat-label>New Genres (comma-separated)</mat-label>
        <input matInput [(ngModel)]="song.genresText" (blur)="updateGenres(i)" placeholder="e.g. Rock, Pop" />
      </mat-form-field>

      <!-- Artist Dropdown -->
      <mat-form-field class="full-width" appearance="outline">
        <mat-label>Artists</mat-label>
        <mat-select multiple [(ngModel)]="song.artists">
          <mat-option *ngFor="let artist of artists" [value]="{'id' :artist.id, 'name' : artist.name}" style="background-color: #333333">
            {{ artist.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <br>

      <!-- Cover Image Upload (no mat-form-field) -->
      <div class="file-input">
        <label>Cover Image:</label>
        <input type="file" (change)="onImageSelected($event, i)" accept="image/*" />
      </div>

      <div *ngIf="song.imagePreview" class="image-preview">
        <img [src]="song.imagePreview" alt="Cover Preview" height="120" />
      </div>

      <!-- Remove Song -->
      <button mat-stroked-button color="warn" *ngIf="uploads.length > 1" (click)="removeSong(i)" style="margin: 1rem">
        <mat-icon>delete</mat-icon>
        Remove Song
      </button>

      <mat-divider></mat-divider>
    </div>

    <!-- Add Another Song -->
    <div class="actions">
      <button mat-stroked-button color="accent" (click)="addAnotherSong()">
        + Add Another Song
      </button>
    </div>

    <!-- Submit -->
    <div class="actions">
      <button mat-raised-button color="primary" (click)="submit()">
        Upload
      </button>
    </div>

    <!-- Upload Progress Bar -->
    <div *ngIf="isUploading" class="progress-container">
      <mat-progress-bar
        mode="determinate"
        [value]="totalProgress"
        color="accent">
      </mat-progress-bar>

      <p class="progress-text">{{ totalProgress }}%</p>
    </div>
  </mat-card>
</div>
